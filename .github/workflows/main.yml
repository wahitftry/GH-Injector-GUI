# This is a GitHub action workflow to compile the GH-Injector-GUI repository
# using Visual Studio 2019 and Qt 5.15.2
# Disclaimer: This code is generated by Bing and has not been tested or verified.

name: Compile GH-Injector-GUI

on: [push, pull_request]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install Visual Studio 2019
        uses: microsoft/setup-msbuild@v1.0.2

      - name: Install Qt 5.15.2
        uses: jurplel/install-qt-action@v2.15.0
        with:
          version: '5.15.2'
          arch: 'win64_msvc2019_64'
          tools: 'tools_qtcreator'

      - name: Install Qt VS Tools for Visual Studio 2019
        run: |
          choco install visualstudio2019-workload-vctools --includeOptional
          choco install visualstudio2019marketplaceextension --includeOptional
          choco install qt-vs-tools --version=2.7.2 --includeOptional

      - name: Download and extract static Qt 5.15.2
        run: |
          Invoke-WebRequest -Uri https://github.com/martinrotter/qt5-minimalistic-builds/releases/download/5.15.2/qt-5.15.2-static-msvc2019-x86_64.zip -OutFile qt-static.zip
          Expand-Archive -Path qt-static.zip -DestinationPath C:\Qt\5.15.2\qt-5.15.2-static-msvc2019-x86_64

      - name: Setup MSVC and Qt options
        run: |
          & "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\Common7\IDE\devenv.com" /Command "QtVsTools.AddQtVersion C:\Qt\5.15.2\msvc2019"
          & "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\Common7\IDE\devenv.com" /Command "QtVsTools.AddQtVersion C:\Qt\5.15.2\msvc2019_64"
          & "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\Common7\IDE\devenv.com" /Command "QtVsTools.AddQtVersion C:\Qt\5.15.2\qt-5.15.2-static-msvc2019-x86_64"
          & "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\Common7\IDE\devenv.com" /Command "QtVsTools.SetCurrentQtVersion x86 msvc2019"
          & "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\Common7\IDE\devenv.com" /Command "QtVsTools.SetCurrentQtVersion x64 msvc2019_64"
          & "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\Common7\IDE\devenv.com" /Command "QtVsTools.SetCurrentQtVersion x64_static qt-5.15.2-static-msvc2019-x86_64"

      - name: Build project
        run: |
          msbuild GH Injector GUI.sln /p:Configuration=Release /p:Platform=x64_static
